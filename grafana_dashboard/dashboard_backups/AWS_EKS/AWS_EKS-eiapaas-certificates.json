{"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": {"limit": 100, "matchAny": false, "tags": [], "type": "dashboard"}, "type": "dashboard"}]}, "description": "Unified dashboard for checking certificates expiration: Kubernetes Secrets, certificate files on nodes, or on any server.", "editable": true, "gnetId": 13922, "graphTooltip": 0, "id": 166, "iteration": 1668766467968, "links": [], "panels": [{"datasource": null, "gridPos": {"h": 3, "w": 24, "x": 0, "y": 0}, "id": 49, "options": {"content": "<h1 style=\"background-color:  #002561;text-align: center\">\n   EIAPaaS Deployments Certificates Dashboard\n</h1>\n<p style=\"font-style: italic\">Certificate Dashboard for EIAPaaS Deployments</p>\n<hr width=\"100%\" />\n<br>\n", "mode": "html"}, "pluginVersion": "8.1.3", "type": "text"}, {"collapsed": false, "datasource": null, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 3}, "id": 24, "panels": [], "title": "Overview", "type": "row"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "super-light-blue", "value": null}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 6, "w": 5, "x": 0, "y": 4}, "id": 2, "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "count(x509_cert_not_after{job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"})", "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Total Certificates", "type": "stat"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "dark-red", "value": 1}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 6, "w": 3, "x": 5, "y": 4}, "id": 18, "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "sum(((x509_cert_not_after{job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - time()) / 86400) < bool 0)", "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Expired", "type": "stat"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 6, "w": 3, "x": 8, "y": 4}, "id": 19, "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "sum(0 < ((x509_cert_not_after{job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - time()) / 86400) < bool $critical_threshold)", "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Expiring within $critical_threshold days", "type": "stat"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 6, "w": 3, "x": 11, "y": 4}, "id": 20, "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "sum(0 < ((x509_cert_not_after{job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - time()) / 86400) < bool $warning_threshold)", "instant": false, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Expiring within $warning_threshold days", "type": "stat"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "super-light-blue", "value": null}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 3, "w": 3, "x": 21, "y": 4}, "id": 17, "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "count(x509_read_errors)", "instant": false, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Exporters", "type": "stat"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "none"}, "overrides": []}, "gridPos": {"h": 3, "w": 3, "x": 21, "y": 7}, "id": 36, "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "text": {}, "textMode": "value"}, "pluginVersion": "8.1.3", "targets": [{"expr": "sum(x509_read_errors)", "instant": false, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Exporter Errors", "type": "stat"}, {"collapsed": false, "datasource": null, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 10}, "id": 26, "panels": [], "title": "Expiration", "type": "row"}, {"datasource": "${environment}", "description": "Because of a missing feature in Grafana, critical and warning thresholds from dashboard variables will not affect coloration of the Time Left column in this table.\n\nThresholds are to be set manually in the Overrides settings for this widget.\n\nPlease vote or contribute to issue : https://github.com/grafana/grafana/issues/922", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": null, "displayMode": "auto", "filterable": true}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}}, "overrides": [{"matcher": {"id": "byName", "options": "Time Left"}, "properties": [{"id": "custom.align", "value": "center"}, {"id": "custom.width", "value": 200}, {"id": "custom.filterable", "value": false}, {"id": "custom.displayMode", "value": "color-background"}, {"id": "thresholds", "value": {"mode": "absolute", "steps": [{"color": "dark-red", "value": null}, {"color": "red", "value": 0}, {"color": "yellow", "value": 7}, {"color": "green", "value": 28}]}}, {"id": "unit", "value": "d"}]}]}, "gridPos": {"h": 13, "w": 12, "x": 0, "y": 11}, "id": 46, "options": {"showHeader": true}, "pluginVersion": "8.1.3", "targets": [{"exemplar": false, "expr": "sort(((x509_cert_not_after{secret_name!=\"\",  job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - time())/86400) < 180)", "format": "table", "instant": true, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Kubernetes Secrets (time left < $list_threshold days)", "transformations": [{"id": "filterFieldsByName", "options": {"include": {"pattern": "^(subject_CN|secret_namespace|secret_name|Value)$"}}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {"Value": 3, "secret_name": 2, "secret_namespace": 1, "subject_CN": 0}, "renameByName": {"Value": "Time Left", "secret_name": "Secret Name", "secret_namespace": "Secret Namespace", "subject_CN": "Subject CN"}}}], "type": "table"}, {"datasource": "${environment}", "description": "Because of a missing feature in Grafana, critical and warning thresholds from dashboard variables will not affect coloration of the Time Left column in this table.\n\nThresholds are to be set manually in the Overrides settings for this widget.\n\nPlease vote or contribute to issue : https://github.com/grafana/grafana/issues/922", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": null, "displayMode": "auto", "filterable": true}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}}, "overrides": [{"matcher": {"id": "byName", "options": "Time Left"}, "properties": [{"id": "custom.align", "value": "center"}, {"id": "custom.width", "value": 200}, {"id": "custom.filterable", "value": false}, {"id": "custom.displayMode", "value": "color-background"}, {"id": "thresholds", "value": {"mode": "absolute", "steps": [{"color": "dark-red", "value": null}, {"color": "red", "value": 0}, {"color": "yellow", "value": 7}, {"color": "green", "value": 28}]}}, {"id": "unit", "value": "d"}]}]}, "gridPos": {"h": 13, "w": 12, "x": 12, "y": 11}, "id": 47, "options": {"showHeader": true}, "pluginVersion": "8.1.3", "targets": [{"exemplar": false, "expr": "x509_cert_not_after{job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"}", "format": "table", "instant": true, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "timeFrom": null, "timeShift": null, "title": "Total Certificates List", "transformations": [{"id": "filterFieldsByName", "options": {"include": {"names": ["secret_name", "secret_namespace", "subject_CN"], "pattern": "^(subject_CN|secret_namespace|secret_name|Value)$"}}}, {"id": "organize", "options": {"excludeByName": {"Value": true}, "indexByName": {"Value": 3, "secret_name": 2, "secret_namespace": 1, "subject_CN": 0}, "renameByName": {"Value": "Time Left", "secret_name": "Secret Name", "secret_namespace": "Secret Namespace", "subject_CN": "Subject CN"}}}], "type": "table"}, {"collapsed": false, "datasource": null, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 24}, "id": 12, "panels": [], "title": "Charts", "type": "row"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": null, "displayMode": "auto", "filterable": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": [{"matcher": {"id": "byName", "options": "Days"}, "properties": [{"id": "custom.align", "value": "center"}, {"id": "custom.width", "value": 100}]}, {"matcher": {"id": "byName", "options": "Secret Namespace"}, "properties": [{"id": "custom.width", "value": 258}]}]}, "gridPos": {"h": 12, "w": 12, "x": 0, "y": 25}, "id": 31, "options": {"showHeader": true, "sortBy": []}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "bottomk(10, (x509_cert_not_after{secret_name!=\"\",job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - x509_cert_not_before) / 86400)", "format": "table", "instant": true, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "title": "Kubernetes Secrets : Shortest Validity Period", "transformations": [{"id": "filterFieldsByName", "options": {"include": {"pattern": "^(subject_CN|secret_namespace|secret_name|Value)$"}}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {"Value": 3, "secret_name": 2, "secret_namespace": 1, "subject_CN": 0}, "renameByName": {"Value": "Days", "secret_name": "Secret Name", "secret_namespace": "Secret Namespace", "subject_CN": "Subject CN"}}}], "type": "table"}, {"datasource": "${environment}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": null, "displayMode": "auto", "filterable": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": [{"matcher": {"id": "byName", "options": "Days"}, "properties": [{"id": "custom.align", "value": "center"}, {"id": "custom.width", "value": 100}]}]}, "gridPos": {"h": 12, "w": 12, "x": 12, "y": 25}, "id": 28, "options": {"showHeader": true}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "topk(10, (x509_cert_not_after{secret_name!=\"\",job=\"certificates-exporter\", subject_O=~\"Ericsson.*\"} - x509_cert_not_before) / 86400)", "format": "table", "instant": true, "interval": "", "legendFormat": "", "queryType": "randomWalk", "refId": "A"}], "title": "Kubernetes Secrets : Longest Validity Period", "transformations": [{"id": "filterFieldsByName", "options": {"include": {"pattern": "^(subject_CN|secret_namespace|secret_name|Value)$"}}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {"Value": 3, "secret_name": 2, "secret_namespace": 1, "subject_CN": 0}, "renameByName": {"Value": "Days", "secret_name": "Secret Name", "secret_namespace": "Secret Namespace", "subject_CN": "Subject CN"}}}], "type": "table"}, {"collapsed": false, "datasource": null, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 37}, "id": 35, "panels": [], "title": "Exporters", "type": "row"}], "refresh": false, "schemaVersion": 30, "style": "dark", "tags": [], "templating": {"list": [{"current": {"selected": true, "text": "ecosystem01", "value": "ecosystem01"}, "description": "List of all  EIAPaaS EKS Environments", "error": null, "hide": 0, "includeAll": false, "label": "Environment", "multi": false, "name": "environment", "options": [], "query": "prometheus", "queryValue": "", "refresh": 1, "regex": "^(?!(?:.*[Tt]est.*|DEV1-EIAP_PROM|Prometheus-.*|subsystems|Prometheus-1-dev2|Subsystem-XDN|dev1-eiappm|Prometheus|idunaasdev03|idunaasdev04)$).*$", "skipUrlSync": false, "type": "datasource"}, {"allValue": null, "current": {"selected": false, "text": "7", "value": "7"}, "description": null, "error": null, "hide": 0, "includeAll": false, "label": "Critical Threshold (days)", "multi": false, "name": "critical_threshold", "options": [{"selected": false, "text": "1", "value": "1"}, {"selected": true, "text": "7", "value": "7"}, {"selected": false, "text": "14", "value": "14"}, {"selected": false, "text": "15", "value": "15"}, {"selected": false, "text": "28", "value": "28"}, {"selected": false, "text": "30", "value": "30"}, {"selected": false, "text": "60", "value": "60"}, {"selected": false, "text": "90", "value": "90"}, {"selected": false, "text": "180", "value": "180"}, {"selected": false, "text": "365", "value": "365"}], "query": "1,7,14,15,28,30,60,90,180,365", "queryValue": "", "skipUrlSync": false, "type": "custom"}, {"allValue": null, "current": {"selected": false, "text": "30", "value": "30"}, "description": null, "error": null, "hide": 0, "includeAll": false, "label": "Warning Threshold (days)", "multi": false, "name": "warning_threshold", "options": [{"selected": false, "text": "1", "value": "1"}, {"selected": false, "text": "7", "value": "7"}, {"selected": false, "text": "14", "value": "14"}, {"selected": false, "text": "15", "value": "15"}, {"selected": false, "text": "28", "value": "28"}, {"selected": true, "text": "30", "value": "30"}, {"selected": false, "text": "60", "value": "60"}, {"selected": false, "text": "90", "value": "90"}, {"selected": false, "text": "180", "value": "180"}, {"selected": false, "text": "365", "value": "365"}], "query": "1,7,14,15,28,30,60,90,180,365", "queryValue": "", "skipUrlSync": false, "type": "custom"}, {"allValue": null, "current": {"selected": false, "text": "180", "value": "180"}, "description": null, "error": null, "hide": 0, "includeAll": false, "label": "List expiring in less than (days)", "multi": false, "name": "list_threshold", "options": [{"selected": false, "text": "1", "value": "1"}, {"selected": false, "text": "7", "value": "7"}, {"selected": false, "text": "15", "value": "15"}, {"selected": false, "text": "30", "value": "30"}, {"selected": false, "text": "60", "value": "60"}, {"selected": false, "text": "90", "value": "90"}, {"selected": true, "text": "180", "value": "180"}, {"selected": false, "text": "365", "value": "365"}, {"selected": false, "text": "730", "value": "730"}, {"selected": false, "text": "1095", "value": "1095"}, {"selected": false, "text": "1460", "value": "1460"}, {"selected": false, "text": "1825", "value": "1825"}, {"selected": false, "text": "3650", "value": "3650"}, {"selected": false, "text": "7300", "value": "7300"}], "query": "1,7,15,30,60,90,180,365,730,1095,1460,1825,3650,7300", "queryValue": "", "skipUrlSync": false, "type": "custom"}]}, "time": {"from": "now-6h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "EIAPaaS Certificates", "uid": "lHnsYlPGk", "version": 35}